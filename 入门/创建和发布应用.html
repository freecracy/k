<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <title>创建和发布应用 | k8s笔记</title><meta name="description" content="just a little"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.22">
    <link rel="modulepreload" href="/k/assets/app.e373aad4.js"><link rel="modulepreload" href="/k/assets/创建和发布应用.html.5f61c2d5.js"><link rel="modulepreload" href="/k/assets/创建和发布应用.html.d352dc01.js">
    <link rel="stylesheet" href="/k/assets/style.e4ee3834.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><span><a href="/k/" class=""><img class="logo" src="https://www.google.com.hk/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png" alt="k8s笔记"><span class="site-name can-hide">k8s笔记</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="指南"><span class="title">指南</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="指南"><span class="title">指南</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/k/入门/基础.md" class="nav-link" aria-label="入门"><!--[--><!--]--> 入门 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="文章"><span class="title">文章</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="文章"><span class="title">文章</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/k/%E5%85%B6%E5%AE%83/%E6%9C%8D%E5%8A%A1.html" class="nav-link" aria-label="服务"><!--[--><!--]--> 服务 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/k/%E5%85%B6%E5%AE%83/ELK%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" class="nav-link" aria-label="ELK 环境搭建"><!--[--><!--]--> ELK 环境搭建 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/k/%E5%85%B6%E5%AE%83/proto3.html" class="nav-link" aria-label="proto3"><!--[--><!--]--> proto3 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/k/%E5%85%B6%E5%AE%83/Makefile.html" class="nav-link" aria-label="Makefile"><!--[--><!--]--> Makefile <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a class="nav-link external" href="https://clickhouse.tech/docs/zh/" rel="noopener noreferrer" target="_blank" aria-label="clickHouse"><!--[--><!--]--> clickHouse <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://etcd.io" rel="noopener noreferrer" target="_blank" aria-label="etcd"><!--[--><!--]--> etcd <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://www.typescriptlang.org" rel="noopener noreferrer" target="_blank" aria-label="ts"><!--[--><!--]--> ts <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://grafana.com/oss/" rel="noopener noreferrer" target="_blank" aria-label="grafana"><!--[--><!--]--> grafana <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://www.rust-lang.org/zh-CN/" rel="noopener noreferrer" target="_blank" aria-label="rust"><!--[--><!--]--> rust <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://www.codepile.net" rel="noopener noreferrer" target="_blank" aria-label="代码编辑平台"><!--[--><!--]--> 代码编辑平台 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://github.com/filebrowser/filebrowser" rel="noopener noreferrer" target="_blank" aria-label="文件服务器"><!--[--><!--]--> 文件服务器 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><a class="nav-link external" href="http://wpa.qq.com/msgrd?v=3&amp;uin=295984047&amp;site=qq&amp;menu=yes" rel="noopener noreferrer" target="_blank" aria-label="联系我"><!--[--><!--]--> 联系我 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="指南"><span class="title">指南</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="指南"><span class="title">指南</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/k/入门/基础.md" class="nav-link" aria-label="入门"><!--[--><!--]--> 入门 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="文章"><span class="title">文章</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="文章"><span class="title">文章</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/k/%E5%85%B6%E5%AE%83/%E6%9C%8D%E5%8A%A1.html" class="nav-link" aria-label="服务"><!--[--><!--]--> 服务 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/k/%E5%85%B6%E5%AE%83/ELK%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.html" class="nav-link" aria-label="ELK 环境搭建"><!--[--><!--]--> ELK 环境搭建 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/k/%E5%85%B6%E5%AE%83/proto3.html" class="nav-link" aria-label="proto3"><!--[--><!--]--> proto3 <!--[--><!--]--></a></li><li class="dropdown-item"><a href="/k/%E5%85%B6%E5%AE%83/Makefile.html" class="nav-link" aria-label="Makefile"><!--[--><!--]--> Makefile <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="其它"><span class="title">其它</span><span class="right arrow"></span></button><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a class="nav-link external" href="https://clickhouse.tech/docs/zh/" rel="noopener noreferrer" target="_blank" aria-label="clickHouse"><!--[--><!--]--> clickHouse <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://etcd.io" rel="noopener noreferrer" target="_blank" aria-label="etcd"><!--[--><!--]--> etcd <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://www.typescriptlang.org" rel="noopener noreferrer" target="_blank" aria-label="ts"><!--[--><!--]--> ts <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://grafana.com/oss/" rel="noopener noreferrer" target="_blank" aria-label="grafana"><!--[--><!--]--> grafana <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://www.rust-lang.org/zh-CN/" rel="noopener noreferrer" target="_blank" aria-label="rust"><!--[--><!--]--> rust <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://www.codepile.net" rel="noopener noreferrer" target="_blank" aria-label="代码编辑平台"><!--[--><!--]--> 代码编辑平台 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><li class="dropdown-item"><a class="nav-link external" href="https://github.com/filebrowser/filebrowser" rel="noopener noreferrer" target="_blank" aria-label="文件服务器"><!--[--><!--]--> 文件服务器 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links-item"><a class="nav-link external" href="http://wpa.qq.com/msgrd?v=3&amp;uin=295984047&amp;site=qq&amp;menu=yes" rel="noopener noreferrer" target="_blank" aria-label="联系我"><!--[--><!--]--> 联系我 <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item active">入门</p><ul class=""><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E5%9F%BA%E7%A1%80.html" class="nav-link sidebar-item" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="创建和发布应用"><!--[--><!--]--> 创建和发布应用 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#deployment" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="deployment"><!--[--><!--]--> deployment <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#使用场景" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="使用场景"><!--[--><!--]--> 使用场景 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#deployment-yaml" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="deployment.yaml"><!--[--><!--]--> deployment.yaml <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#创建-deployment" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="创建 deployment"><!--[--><!--]--> 创建 deployment <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#statefulset" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="statefulset"><!--[--><!--]--> statefulset <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#mysql-rc-yaml" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="mysql-rc.yaml"><!--[--><!--]--> mysql-rc.yaml <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#动态修改副本数量" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="动态修改副本数量"><!--[--><!--]--> 动态修改副本数量 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#发布到集群" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="发布到集群"><!--[--><!--]--> 发布到集群 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#mysql-svc-yaml" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="mysql-svc.yaml"><!--[--><!--]--> mysql-svc.yaml <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#service-多端口" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="service 多端口"><!--[--><!--]--> service 多端口 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#dns-系统" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="DNS 系统"><!--[--><!--]--> DNS 系统 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#ip" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ip"><!--[--><!--]--> ip <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#创建-service" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="创建 service"><!--[--><!--]--> 创建 service <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#app-yaml" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="app.yaml"><!--[--><!--]--> app.yaml <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#滚动升级" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="滚动升级"><!--[--><!--]--> 滚动升级 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#hpa-横向自动扩容" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="HPA-横向自动扩容"><!--[--><!--]--> HPA-横向自动扩容 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#负载度量指标" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="负载度量指标"><!--[--><!--]--> 负载度量指标 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/k/%E5%85%A5%E9%97%A8/%E5%88%9B%E5%BB%BA%E5%92%8C%E5%8F%91%E5%B8%83%E5%BA%94%E7%94%A8.html#小记" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="小记"><!--[--><!--]--> 小记 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE.html" class="nav-link sidebar-item" aria-label="安装配置"><!--[--><!--]--> 安装配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1pod.html" class="nav-link sidebar-item" aria-label="深入掌握 pod"><!--[--><!--]--> 深入掌握 pod <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E6%B7%B1%E5%85%A5%E6%8E%8C%E6%8F%A1service.html" class="nav-link sidebar-item" aria-label="深入掌握 service"><!--[--><!--]--> 深入掌握 service <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6.html" class="nav-link sidebar-item" aria-label="核心组件运行机制"><!--[--><!--]--> 核心组件运行机制 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6.html" class="nav-link sidebar-item" aria-label="集群安全机制"><!--[--><!--]--> 集群安全机制 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E7%BD%91%E7%BB%9C.html" class="nav-link sidebar-item" aria-label="网络"><!--[--><!--]--> 网络 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E5%AD%98%E5%82%A8.html" class="nav-link sidebar-item" aria-label="存储"><!--[--><!--]--> 存储 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86.html" class="nav-link sidebar-item" aria-label="集群管理"><!--[--><!--]--> 集群管理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.html" class="nav-link sidebar-item" aria-label="开发指南"><!--[--><!--]--> 开发指南 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/k/%E5%85%A5%E9%97%A8/%E9%97%AE%E9%A2%98%E9%9B%86.html" class="nav-link sidebar-item" aria-label="问题集"><!--[--><!--]--> 问题集 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="创建和发布应用" tabindex="-1"><a class="header-anchor" href="#创建和发布应用" aria-hidden="true">#</a> 创建和发布应用</h1><h2 id="deployment" tabindex="-1"><a class="header-anchor" href="#deployment" aria-hidden="true">#</a> deployment</h2><p>是 RC 的升级版,最大的特点是我们可以随时知道当前 pod 的部署进度.即一个 pod 创建、调度、绑定节点、在目标 node 上启动对应容器的部署过程.</p><h3 id="使用场景" tabindex="-1"><a class="header-anchor" href="#使用场景" aria-hidden="true">#</a> 使用场景</h3><ol><li>创建 deployment 对象来生成对应 Replica Set 并完成 pod 副本创建</li><li>检查 deployment 的状态来看部署是否完成(pod 副本数量是否达到预期值)</li><li>更新 deployment 以创建新的 pod (如镜像升级)</li><li>如果当前 deployment 不稳定,则回滚到一个早先的 deloyment 版本</li><li>暂停 deployment 以便一次修改多个 podtemplatespec 配置,之后再恢复,进行新的发布</li></ol><h3 id="deployment-yaml" tabindex="-1"><a class="header-anchor" href="#deployment-yaml" aria-hidden="true">#</a> deployment.yaml</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiversion</span><span class="token punctuation">:</span> extensions/vlbetal
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
	<span class="token key atrule">name</span><span class="token punctuation">:</span> frontend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
	<span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
	<span class="token key atrule">selector</span><span class="token punctuation">:</span>
	<span class="token key atrule">matchlabels</span><span class="token punctuation">:</span>
		<span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
	matchexpressions
		<span class="token punctuation">-</span>	<span class="token punctuation">{</span><span class="token key atrule">key</span><span class="token punctuation">:</span> tier<span class="token punctuation">,</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> In<span class="token punctuation">,</span> <span class="token key atrule">values</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>frontend<span class="token punctuation">]</span>)
	<span class="token key atrule">template</span><span class="token punctuation">:</span>
		metadata
		<span class="token key atrule">labels</span><span class="token punctuation">:</span>
			<span class="token key atrule">app</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>demo
			<span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
		spec
			containers
			<span class="token punctuation">-</span>	<span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">-</span>demo
				<span class="token key atrule">mage</span><span class="token punctuation">:</span> tomcat
				<span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
				<span class="token key atrule">ports</span><span class="token punctuation">:</span>
				<span class="token punctuation">-</span>	<span class="token key atrule">containerport</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="创建-deployment" tabindex="-1"><a class="header-anchor" href="#创建-deployment" aria-hidden="true">#</a> 创建 deployment</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl create -f deployment.yaml <span class="token comment"># 创建</span>
kubectl get deployment <span class="token comment"># 查看</span>
kubectl describe deployments <span class="token comment"># 清楚的看到 deployment 控制 pod 的水平扩张过程</span>
kubectl get rs <span class="token comment"># 查看 Relica Set</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>get 结果 :</p><table><thead><tr><th>列</th><th>含义</th></tr></thead><tbody><tr><td>DESIRED</td><td>pod 副本数量的期望值,即 Replica</td></tr><tr><td>CURRENT</td><td>当前 Relica 值,当前 pod 副本数</td></tr><tr><td>UP-TO-DATE</td><td>最新版本的 pod 副本数量,指示滚动升级过程中有多少个 pod 副本已经成功升级</td></tr><tr><td>AVAILABLE</td><td>当前集群中可用 pod 副本数量,即集群中当前存活的 pod 副本数量</td></tr></tbody></table><h2 id="statefulset" tabindex="-1"><a class="header-anchor" href="#statefulset" aria-hidden="true">#</a> statefulset</h2><p>可以看作 deployment/RC 的变种:</p><ol><li><p>每个 pod 都有稳定、唯一网络标识用来发现集群内其它成员,假设名称为 kafka,那么第一个叫 kafka-0,第二个叫 kafka-1</p></li><li><p>控制的 pod 副本启动顺序是受控制的</p></li><li><p>除了与 pv 卷捆绑以存储 pod 状态数据,还要使用 headless service,headless service 没有 cluster ip,解析 dns 域名返回全部 pod 的 endpoint 列表.为每个 pod 实例创建一个 DNS 域名.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token variable"><span class="token variable">$(</span>podname<span class="token variable">)</span></span><span class="token builtin class-name">.</span><span class="token variable"><span class="token variable">$(</span>headless <span class="token function">service</span> name<span class="token variable">)</span></span> <span class="token comment"># kafka-0.kafka、kafka-1.kafka</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li></ol><h2 id="mysql-rc-yaml" tabindex="-1"><a class="header-anchor" href="#mysql-rc-yaml" aria-hidden="true">#</a> mysql-rc.yaml</h2><p>Replica Set 与 Deployment 两个重要的资源对象正在逐步取代 RC.</p><p>Replication Controller (1.2 版本后叫做 Replica Set ) 定义一个期望场景,声明某个 pod 副本数量在任意时刻都符合某个预期的值.通过 RC 实现用户集群的高可用,包括以下几个部分</p><ol><li>pod 期待副本数</li><li>用于筛选目标 pod 的 label selector</li><li>当副本数量小于预期数量时,用于创建新 pod 的 pod 模版 ( template )</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RepicationController <span class="token comment"># 副本控制器</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
	<span class="token key atrule">name</span><span class="token punctuation">:</span> mysql <span class="token comment"># rc 名称,全局唯一</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
	<span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># 期待 pod 副本数</span>
	<span class="token key atrule">selector</span><span class="token punctuation">:</span>
		<span class="token key atrule">app</span><span class="token punctuation">:</span> mysql <span class="token comment"># 监控和管理有这些标签的 pod 实例</span>
	<span class="token key atrule">template</span><span class="token punctuation">:</span>
		<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
			<span class="token key atrule">labels</span><span class="token punctuation">:</span>
				<span class="token key atrule">app</span><span class="token punctuation">:</span> app<span class="token punctuation">-</span>demo
				<span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
		<span class="token key atrule">spec</span><span class="token punctuation">:</span>
			containers
			<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">-</span>demo
				<span class="token key atrule">lmage</span><span class="token punctuation">:</span> tomcat
				<span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
			env
			<span class="token punctuation">-</span>	<span class="token key atrule">name</span><span class="token punctuation">:</span> GET_HOSTS_FROM
				<span class="token key atrule">value</span><span class="token punctuation">:</span> dns
			<span class="token key atrule">ports</span><span class="token punctuation">:</span>
			<span class="token punctuation">-</span>	<span class="token key atrule">containerport</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="动态修改副本数量" tabindex="-1"><a class="header-anchor" href="#动态修改副本数量" aria-hidden="true">#</a> 动态修改副本数量</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl scale rc redis-slave --replicas<span class="token operator">=</span><span class="token number">3</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>删除 RC 不会影响通过该 RC 已经创建好的 pod,为了删除所有 pod,可以设置 replicas 为 0,然后更新该 RC. kubectl 提供 stop 和 delete 命令来一次删除 RC 和 RC 控制的全部 pod</p><h2 id="发布到集群" tabindex="-1"><a class="header-anchor" href="#发布到集群" aria-hidden="true">#</a> 发布到集群</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl create -f rc.yaml <span class="token comment"># 创建</span>
kubectl get rc <span class="token comment"># 查看创建的 rc</span>
kubectl get pods <span class="token comment"># 查看 pod 创建情况, pod 创建时间较长时状态从 pending -&gt; running</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="mysql-svc-yaml" tabindex="-1"><a class="header-anchor" href="#mysql-svc-yaml" aria-hidden="true">#</a> mysql-svc.yaml</h2><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiverslon</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service <span class="token comment">#表明是 Kubernetes Service</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
	<span class="token key atrule">name</span><span class="token punctuation">:</span> mysql <span class="token comment"># Service 的全局唯一名称</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
 	<span class="token key atrule">ports</span><span class="token punctuation">:</span>
 		<span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3306</span> <span class="token comment"># Service 提供服务的端口号</span>
 	<span class="token key atrule">selector</span><span class="token punctuation">:</span> <span class="token comment"># Service 对应的 Pod 拥有这里定义的标签</span>
 		<span class="token key atrule">app</span><span class="token punctuation">:</span> mysql
  <span class="token key atrule">env</span><span class="token punctuation">:</span>            <span class="token comment"># 注入环境变量</span>
  	<span class="token key atrule">-name</span> <span class="token punctuation">:</span> E
  	 <span class="token key atrule">value</span> <span class="token punctuation">:</span> a
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="service-多端口" tabindex="-1"><a class="header-anchor" href="#service-多端口" aria-hidden="true">#</a> service 多端口</h3><p>有些服务一个端口提供业务服务,一个端口提供管理服务,要求每个 endpoint 都有一个名称来区分</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">Ports</span><span class="token punctuation">:</span>
	<span class="token punctuation">-</span>	<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
		<span class="token key atrule">name</span><span class="token punctuation">:</span> service<span class="token punctuation">-</span>port
	<span class="token punctuation">-</span>	<span class="token key atrule">port</span><span class="token punctuation">:</span>	<span class="token number">8005</span>
		<span class="token key atrule">name</span><span class="token punctuation">:</span> shutdown<span class="token punctuation">-</span>port
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="dns-系统" tabindex="-1"><a class="header-anchor" href="#dns-系统" aria-hidden="true">#</a> DNS 系统</h3><p>实现服务发现.</p><h3 id="ip" tabindex="-1"><a class="header-anchor" href="#ip" aria-hidden="true">#</a> ip</h3><ol><li>node ip : k8s 之外的节点访问访问集群内服务时必须通过 node ip 通信.</li><li>pod ip : 是 docker engine 根据 docker0 网桥 ip 地址段进行分配的,是一个虚拟的二层网络,一个 pod 里的容器访问另一个 pod 里的容器时通过 pod ip 所在的二层网络进行通信.真实的 tcp/ip 流量通过 node ip 物理网卡流出</li><li>cluster ip 虚拟 ip,像一个伪造的 ip 网络 <ul><li>仅作用于 service 这个对象,由 k8s 管理和分配</li><li>无法被 ping,因为没有一个实体网络对象来相应</li><li>只能和 service port 组成一个具体通信端口,属于内部地址,无法外部直接使用</li></ul></li></ol><p>采用 nodeport 提供外部应用访问入口:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">spec</span><span class="token punctuation">:</span>
	<span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
	<span class="token key atrule">ports</span><span class="token punctuation">:</span>
		<span class="token punctuation">-</span>	<span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
			<span class="token key atrule">nodeport</span><span class="token punctuation">:</span> <span class="token number">31002</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>nodeport 解决外部访问问题,但是没解决负载均衡,需要单独部署.HAProxy 或 Nginx.</p><h2 id="创建-service" tabindex="-1"><a class="header-anchor" href="#创建-service" aria-hidden="true">#</a> 创建 service</h2><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl create -f mysql-svc.yaml <span class="token comment"># 创建 service</span>
kubectl get svc <span class="token comment"># 查看创建的 service</span>
kubectl get svc mysql -o yaml <span class="token comment"># 查看服务 yaml 文件</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>cluster ip 是服务创建后系统自动分配的,pod 无法预先知道某个 service 的 cluster ip,因此需要服务发现机制来找到这个服务.k8s使用环境变量来解决这个问题,容器可以从环境变量中获取 service 对应的 cluster IP 和端口,从而发起 tcp/ip 连接请求.</p><p><img src="/k/assets/k8s-service.f5bacd27.png" alt="k8s-service"></p><h2 id="app-yaml" tabindex="-1"><a class="header-anchor" href="#app-yaml" aria-hidden="true">#</a> app.yaml</h2><p>应用容器内使用环境变量 MYSQL_SERVICE_HOST 的值连接 mysql 服务,更安全可靠的方法是应用服务的名称.</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">type</span> <span class="token punctuation">:</span> NodePort
nodePort <span class="token punctuation">:</span><span class="token number">30001</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此 service 开启 nodeport 外网访问模式,集群之外可以通过 nodePort 访问服务.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl get services
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="滚动升级" tabindex="-1"><a class="header-anchor" href="#滚动升级" aria-hidden="true">#</a> 滚动升级</h2><h2 id="hpa-横向自动扩容" tabindex="-1"><a class="header-anchor" href="#hpa-横向自动扩容" aria-hidden="true">#</a> HPA-横向自动扩容</h2><h3 id="负载度量指标" tabindex="-1"><a class="header-anchor" href="#负载度量指标" aria-hidden="true">#</a> 负载度量指标</h3><ol><li>CPUUtilizationPercentage : 目标 pod 所有副本自身 cpu 利用率的平均值,一个 pod 自身的 cpu 使用率是该 pod 当前 cpu 使用量除以他的 pod request 的值.如果目标没有定义 pod Request 无法使用该值实现横向自动扩容.该值超过 80% 会自动扩容,高峰过去后 cpu 利用率降下来 pod 副本数将少到合理水平.计算过程通常是 1min 钟的平均值,痛殴查询 heapster 监控子系统得到这个值需要安装部署 heapster.从 1.7 版本后 k8s 自身孵化了一个基础性能数据采集监控框架 Kubernetes Monitoring Architecture.</li><li>应用程序自定义度量指标(如 qps、tps)</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 控制一个目标对象名为 php-apache 的 deloyment 里 pod 副本数,当 Cpuutilizationpercentage 超过 90% 会触发自动扩容,在扩容和缩容时必须满足一个约束条件是 pod 副本数为 1-10</span>
<span class="token key atrule">apiversion</span><span class="token punctuation">:</span> autoscaling/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HorizontalPodAutoscaler
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
	<span class="token key atrule">name</span><span class="token punctuation">:</span> php<span class="token punctuation">-</span>apache
	<span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
	<span class="token key atrule">maxreplicas</span><span class="token punctuation">:</span> <span class="token number">10</span>
	<span class="token key atrule">minreplicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
	<span class="token key atrule">scaletargetRef</span><span class="token punctuation">:</span>
		<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
		<span class="token key atrule">name</span><span class="token punctuation">:</span> php<span class="token punctuation">-</span>apache
	<span class="token key atrule">target Cpuutilizationpercentage</span><span class="token punctuation">:</span> <span class="token number">90</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>除了通过直接定义 yaml 文件并调用 kubectl create 命令来创建 HPA 资源对象方式,还可以通过简单的命令行直接创建.</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Kubectl autoscale deployment php-apache --cpu-percent<span class="token operator">=</span><span class="token number">90</span> --min<span class="token operator">=</span>l --max<span class="token operator">=</span><span class="token number">10</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="小记" tabindex="-1"><a class="header-anchor" href="#小记" aria-hidden="true">#</a> 小记</h2><p>rc.yaml 创建 pod, service.yaml 创建服务.</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">最近更新: </span><span class="meta-item-info">2021/7/21 下午3:24:41</span></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/k/%E5%85%A5%E9%97%A8/%E5%9F%BA%E7%A1%80.html" class="nav-link" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></span><span class="next"><a href="/k/%E5%85%A5%E9%97%A8/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE.html" class="nav-link" aria-label="安装配置"><!--[--><!--]--> 安装配置 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main></div><!----><!--]--></div>
    <script type="module" src="/k/assets/app.e373aad4.js" defer></script>
  </body>
</html>
